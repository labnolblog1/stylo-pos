<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>STYLO DRESSES POS</title>

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">

<!-- Theme Color -->
<meta name="theme-color" content="#000000">

<!-- Excel Library -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#f2f2f2;
}
h1{
    background:black;
    color:white;
    text-align:center;
    padding:20px;
    margin:0;
}
.container{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:20px;
    padding:30px;
}
button{
    height:120px;
    font-size:18px;
    font-weight:bold;
    border:none;
    border-radius:12px;
    cursor:pointer;
    background:white;
    box-shadow:0 4px 10px rgba(0,0,0,0.2);
}
button:hover{
    background:black;
    color:white;
}
</style>
</head>

<body>

<h1>STYLO DRESSES</h1>

<div class="container">
    <button onclick="go('sales.html')">Sales</button>
    <button onclick="go('commission.html')">Add Commission</button>
    <button onclick="go('salesman.html')">Add Salesman</button>
    <button onclick="go('day-report.html')">Full Day Report</button>
    <button onclick="go('weekly-report.html')">Weekly Report</button>
    <button onclick="go('monthly-report.html')">Monthly Report</button>
    <button onclick="exportDailyExcel()">Export Daily Excel</button>
</div>

<script>

function go(page){
    window.location.href = page;
}

/* ============================= */
/* EXPORT DAILY EXCEL FUNCTION  */
/* ============================= */

function exportDailyExcel(){

    const today = new Date().toISOString().slice(0,10);
    const sales = JSON.parse(localStorage.getItem("sales")) || [];
    const todaySales = sales.filter(s => s.date === today);

    if(todaySales.length === 0){
        alert("No sales today.");
        return;
    }

    const salesmen = [...new Set(todaySales.map(s => s.salesman))];

    let grouped = {};
    salesmen.forEach(name => {
        grouped[name] = todaySales.filter(s => s.salesman === name);
    });

    let rows = [];

    /* Header Row */
    let headerRow = [];
    salesmen.forEach(name => {
        headerRow.push(name);
        headerRow.push("");
    });
    rows.push(headerRow);

    /* Sales Data */
    let maxRows = Math.max(...salesmen.map(name => grouped[name].length));

    for(let i=0;i<maxRows;i++){
        let row = [];
        salesmen.forEach(name => {
            let sale = grouped[name][i];
            if(sale){
                row.push(sale.amount);
                row.push(sale.commission);
            } else {
                row.push("");
                row.push("");
            }
        });
        rows.push(row);
    }

    rows.push([]);

    /* Final Calculation Row */
    let finalRow = [];

    salesmen.forEach(name => {

        const totalSales = grouped[name].reduce((a,b)=>a+b.amount,0);
        const totalCommission = grouped[name].reduce((a,b)=>a+b.commission,0);

        const onePercentSales = totalSales * 0.01;
        const tenPercentCommission = totalCommission * 0.10;
        const adjustedCommission = totalCommission - tenPercentCommission;

        const finalTotal = onePercentSales + adjustedCommission;

        finalRow.push("Final Total:");
        finalRow.push(finalTotal);
    });

    rows.push(finalRow);

    const worksheet = XLSX.utils.aoa_to_sheet(rows);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Daily Report");

    XLSX.writeFile(workbook, "STYLO_DAILY_" + today + ".xlsx");
}

/* ============================= */
/* SERVICE WORKER REGISTRATION  */
/* ============================= */

if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js')
        .then(() => console.log("Service Worker Registered"))
        .catch(err => console.log("SW registration failed:", err));
    });
}

</script>

</body>
</html>
